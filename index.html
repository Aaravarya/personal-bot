<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PersonalBot</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/supersimpledev/chatbot.js" crossorigin></script>

    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
       body{
        font-family: Arial, Helvetica, sans-serif;
        margin-top: 0px;
        margin-bottom: 0px;
       }
      .button-style{
        background-color: rgb(25,135,84);
        padding: 12px 20px;
        margin-left: 10px;
        border: none;
        border-radius: 10px;
        font-size:15px;
        cursor: pointer;
      }

      .input-style{
        padding:15px 20px;
        border-radius: 10px;
        border-width: 0.8px;
        flex-grow: 1;
      }

      .input-button-container{
        display:flex;
        margin-top:10px;
        margin-bottom:60px;
      }

      .app-container{
        max-width: 600px;
        margin-left:auto;
        margin-right:auto;

        height:100vh;
        display:flex;
        flex-direction:column; 

      }

      .robot-style{
        display:flex;
        margin-top:10px;
        align-items: start;
      }

      .user-style{
         display: flex;
         justify-content: end;
         margin-top:10px;
         align-items: start;
         
      }

      .message-style{
        background-color: rgb(238,238,238);
        padding:10px 15px;
        margin-left:10px;
        margin-right:10px;
        border-radius: 10px;
        max-width: 300px;
      }

      .chat-messages{
        flex-grow:1;
        overflow: scroll;
        scrollbar-width: none;
      }
    </style>
    
</head>
<body>
     
   

    <div id="root"></div>

    <script type="text/babel">
         
         function ChatInput({messages, setMessages}){

            const [message, setMessage] = React.useState('');

             function saveChange(event){
                
                setMessage(event.target.value);
            }

            // function sendMessage(){
               
            //     const response= Chatbot.getResponse(message);

            //     setMessages([
            //         ...messages,
            //         {
            //             message:message,
            //             sender:'user'
            //         },
            //         {
            //             message:response,
            //             sender:'robot'
            //         }
            //     ]);

            //     setMessage('');
            // }

             async function sendMessage() {
  // add user message to chat
  setMessages([
    ...messages,
    {
      message: message,
      sender: 'user'
    }
  ]);

  // send to FastAPI backend
  try {
    const response = await fetch("http://127.0.0.1:8000/ask", {
      method: "POST",
      headers: {
        "Content-Type": "application/json"
      },
      body: JSON.stringify({ question: message })
    });

    const data = await response.json();

    // add bot response to chat
    setMessages(prevMessages => [
      ...prevMessages,
      {
        message: data.answer,
        sender: 'robot'
      }
    ]);
  } catch (error) {
    console.error("Error:", error);
    setMessages(prevMessages => [
      ...prevMessages,
      {
        message: "⚠️ Error connecting to the bot server.",
        sender: "robot"
      }
    ]);
  }

  setMessage('');
}


             
            return (
                <div className="input-button-container">
                    <input 
                        placeholder="send a message!" 
                        size="40"
                        onChange={saveChange}
                        value={message}
                        className="input-style"

                    />

                    <button 
                        onClick={sendMessage}
                        className="button-style"
                     >
                        Send
                    </button>
                </div>
            );
         }

         function ChatMessage(props){
            
            const {message, sender} = props;

                return (
                <div className={
                    sender==='robot'
                    ?'robot-style'
                    :'user-style'
                }
                >
                    {sender==='robot' && (
                        <img src="image/robot-chatbot-icon-modern-bot-sign-vector-27973167.avif" width="40"/>
                      ) 
                    }
                    <div className="message-style">
                       {message}
                    </div>
                    {sender==='user' && (
                        <img src="image/8214212.png" width="40"/>
                      )
                    }
                </div>
                )
        }
            
        function ChatMessages({messages}){
           
          const messagesRef= React.useRef(null);

           React.useEffect(()=>{
              const messagesElem= messagesRef.current;

              if(messagesElem){
                messagesElem.scrollTop=messagesElem.scrollHeight;
              }
           }, [messages]);

           return (
            <div 
            className="chat-messages"
             >
             {
                messages.map((prop) => {
                return (
                    <ChatMessage message={prop.message} sender={prop.sender}/>
                )
               }
              )
            }
            </div>

        )

             
        }
         
        function App(){

             const [messages, setMessages] = React.useState([])

            return (
                <div className="app-container">
                    <ChatMessages messages={messages}/>
                    <ChatInput messages={messages} setMessages={setMessages}/>
                </div>
            );

        }
        


         const container= document.getElementById('root');

         ReactDOM.createRoot(container).render(<App />);
    </script>

</body>
</html>
